import{q as ne,u as re,r as a,y as ce,p as ie,b as S,d as i,e as u,f as n,g as m,m as F,k as R,F as U,l as ue,j as de,t as g,n as w,h as pe,C as me,_ as ye,a as _e,i as fe}from"./app-e1ab7da0.js";import{r as be,u as D}from"./xlsx-4ad528ac.js";import"./dayjs.min-ac6c82aa.js";import{S as Q}from"./Service-a2d19084.js";const X=ne("useImportPayrun",()=>{re();const O=a(!1),r=ce(),d=a(),E=a(),N=a(),y=a([]),f=a([]);a(!1),a(!1);const h=a(),L=a(),b=e=>{N.value=e.target.files[0]},o=(e,t)=>{if(e){var l=e.target.files[0];if(!l)return;var v=new FileReader;v.onload=function(T){const x=v.result;var I=be(x,{type:"binary",cellDates:!0,dateNF:"dd-mm-yyyy"}),J=I.Sheets[I.SheetNames[0]];let $=[];const k={},j=D.decode_range(J["!ref"]);let _;const ae=j.s.r;for(_=j.s.c;_<=j.e.c;++_){const p=J[D.encode_cell({c:_,r:ae})];let A="UNKNOWN "+_;p&&p.t&&(A=D.format_cell(p)),k[_]=A;let B={title:k[_],value:k[_]};k[_].includes("UNKNOWN")||$.push(B)}E.value=$,console.log($);const C=I.SheetNames.reduce((p,A)=>{const B=I.Sheets[A];return p[A]=D.sheet_to_json(B,{raw:!1,dateNF:"dd-mm-yyyy"}),p},{}),V=Object.keys(C)[0];C[V]?d.value=C[V]:d.value=[],d.value&&Y(d.value),y.value.push(d.value);for(let p=0;p<C[V].length;p++)console.log("jsonData['Sheet1'].length :",C[V].length),G(d.value[p])},v.readAsArrayBuffer(l)}else r.add({severity:"error",summary:"file missing!",detail:"selected",life:2e3})},s=e=>{let t="/employee-payrun-data";f.value==0?ie.post(t,e).then(l=>{l.data.status=="failure"?r.add({severity:"error",summary:"failure",detail:`${l.data.message}`,life:3e3}):l.data.status=="success"&&l.data.data.forEach(v=>{r.add({severity:"success",summary:`${v.Employee_Name}`,detail:`${v.message}`,life:3e3})})}).finally(()=>{}):r.add({severity:"error",summary:"Failure!",detail:"Clear error fields",life:3e3})};function M(e){return e.filter((t,l)=>e.indexOf(t)!==l)}let P=a([]),H=a([]),K=a([]),q=a([]),z=a([]),W=a([]);const Y=e=>{e.forEach(t=>{P.value.push(t["Employee Code"]),H.value.push(t.Email),K.value.push(t["Mobile Number"]),q.value.push(t["Pan No"]),z.value.push(t.Aadhar),W.value.push(t["Account No"])})},Z=(e,t)=>!!M(e).includes(t),ee=(e,t)=>(console.log(t),!!e.includes(t)),se=e=>c(e)<=0,oe=a([{id:"1",name:"Salary advance"},{id:"2",name:"Interest free loan"},{id:"3",name:"Travel advance"},{id:"4",name:"Interest with loan"}]),te=(e,t,l)=>{if(console.log({balance:e,loanAmt:t,Repayment:l}),console.log(`loanAmount${c(t)}`),console.log(`repaymentAmount${c(l)}`),e){let x;var T=/\d/.test(l);return T?(x=c(t)-c(l),c(e)!=x):(x=c(t),console.log("======Balance====="+x),c(e)!=x)}console.log(c(e)==balance)},le=(e,t,l)=>{if(console.log({emi:e,balance:t,tenure:l}),e){let T=c(t)/c(l);return console.log("Actual emi:"+c(e)),console.log("subbed emi:"+T),c(e)!=T}},c=e=>{if(e){console.log(e.split(".")[0]);var t=e.split(".")[0],l=t.match(/\d/g);if(l)return l=l.join(""),console.log(`convertRupeeIntoNumber${l}`),parseInt(l)}},G=e=>(console.log(h.value),[]);return{getCurrentlyImportedTableDuplicateEntries:Y,currentlyImportedTableEmployeeCodeValues:P,findCurrentTableDups:Z,uploadOnboardingFile:s,type:L,currentlyImportedTableAadharValues:z,currentlyImportedTablePanValues:q,currentlyImportedTableAccNoValues:W,currentlyImportedTableEmailValues:H,currentlyImportedTableMobileNumberValues:K,loanAmount:se,loanTypes:oe,findBalanceAmount:te,findEmiCalculation:le,isExistsOrNot:ee,convertExcelIntoArray:o,EmployeeSalaryAdvanceDynamicHeader:E,EmployeeSalaryAdvanceSource:d,getValidationMessages:G,getExcelForUpload:b,canShowloading:O}}),ve={class:"grid w-10/12 grid-cols-3 mx-auto my-2 place-content-center"},ge={class:"flex"},he=n("label",{class:"p-2 font-semibold border-gray-500 rounded-lg cursor-pointer border-1 fs-6",for:"file"},[n("i",{class:"px-2 pi pi-folder",style:{"font-size":"1rem"}}),pe("Browse")],-1),xe=me('<div class="p-2 mx-6 font-semibold text-black bg-white rounded-lg fs-6">Total Records : <span class="font-bold"> 2324 </span></div><div class="p-2 mx-6 font-semibold text-black bg-green-100 rounded-lg fs-6">Processed Records : <span class="font-bold"> 2342 </span></div><div class="p-2 mx-6 font-semibold text-black bg-red-100 rounded-lg fs-6">Error Records : <span class="font-bold"> 12313 </span></div>',3),Ee=n("div",{class:"py-5"},[n("p",{class:"font-semibold fs-6"},"Sample format:"),n("div",{class:"table-responsive"})],-1),Ne={class:"table-responsive"},Se=n("p",{class:"font-semibold fs-6"},"Original data:",-1),Te={key:0},Ce={class:"font-semibold fs-6"},Ae={key:1},Ie={class:"font-semibold fs-6"},ke={class:"font-semibold fs-6"},Ve={key:3},Re={class:"font-semibold fs-6"},we={class:"font-semibold fs-6"},De={class:"font-semibold fs-6"},Fe={class:"font-semibold fs-6"},Oe={key:7,class:"font-semibold fs-6"},Le={__name:"import_payrun",setup(O){Q();const r=X(),d=N=>{let{data:y,newValue:f,field:h}=N;switch(h){case"quantity":case"price":isPositiveInteger(f)?y[h]=f:N.preventDefault();break;default:f.trim().length>0?y[h]=f:N.preventDefault();break}},E=["SALARY ADVANCE","INTEREST FREE LOAN","TRAVEL ADVANCE","INTEREST wITH LOAN"];return(N,y)=>{const f=S("InputText"),h=S("Column"),L=S("DataTable");return i(),u(U,null,[n("div",ve,[n("div",ge,[he,n("input",{type:"file",name:"",id:"file",hidden:"",onChange:y[0]||(y[0]=b=>m(r).convertExcelIntoArray(b)),accept:".xls, .xlsx"},null,32)]),xe]),Ee,n("div",Ne,[Se,F(L,{class:"py-4",value:m(r).EmployeeSalaryAdvanceSource,tableStyle:" min-width: 50rem",responsiveLayout:"scroll",stateStorage:"session",stateKey:"dt-state-demo-session",editMode:"cell",onCellEditComplete:d,rows:m(r).EmployeeSalaryAdvanceSource},{footer:R(()=>[n("button",{class:"flex justify-center mx-auto btn btn-orange",onClick:y[1]||(y[1]=b=>m(r).uploadOnboardingFile(m(r).EmployeeSalaryAdvanceSource))},"Upload")]),default:R(()=>[(i(!0),u(U,null,ue(m(r).EmployeeSalaryAdvanceDynamicHeader,b=>(i(),de(h,{key:b.title,field:b.title,style:{"min-width":"12rem"},header:b.title},{body:R(({data:o,field:s})=>[s.includes("Employee Code")?(i(),u("div",Te,[n("p",Ce,g(o[s]?o[s]:"-"),1)])):s.includes("Legal Entity")?(i(),u("div",Ae,[n("p",Ie,g(o[s]?o[s]:"-"),1)])):s.includes("Loan Type")?(i(),u("div",{key:2,class:w([m(r).isExistsOrNot(E,o[s].toUpperCase())?"bg-red-100 p-2 rounded-lg":""])},[n("p",ke,g(o[s]?o[s]:"-"),1)],2)):s.includes("Category")?(i(),u("div",Ve,[n("p",Re,g(o[s]?o[s]:"-"),1)])):s.includes("Loan Amount")?(i(),u("div",{key:4,class:w([m(r).loanAmount(o[s])?"bg-red-100 p-2 rounded-lg":""])},[n("p",we,g(o[s]?o[s]:"-"),1)],2)):s.includes("Balance")?(i(),u("div",{key:5,class:w([m(r).findBalanceAmount(o[s],o["Loan Amount"],o["Repayment Made"])?"bg-red-100 p-2 rounded-lg":""])},[n("p",De,g(o[s]?o[s]:"-"),1)],2)):s.includes("EMI")?(i(),u("div",{key:6,class:w([m(r).findEmiCalculation(o[s],o.Balance,o.Tenure)?"bg-red-100 p-2 rounded-lg":""])},[n("p",Fe,g(o[s]?o[s]:"-"),1)],2)):(i(),u("p",Oe,g(o[s]?o[s]:"-"),1))]),editor:R(({data:o,field:s})=>[F(f,{modelValue:o[s],"onUpdate:modelValue":M=>o[s]=M},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","rows"])])],64)}}};const Me={__name:"payrun_excel_import",setup(O){return X(),Q(),a(null),_e(),(r,d)=>{const E=S("Toast");return S("Column"),S("DataTable"),i(),u(U,null,[F(E),fe("",!0),F(Le)],64)}}},Pe=ye(Me,[["__scopeId","data-v-551ba882"]]);export{Pe as default};
