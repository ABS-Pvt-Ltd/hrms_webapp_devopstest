import{q as me,y as pe,r as o,p as c,x as Ne}from"./app-e1ab7da0.js";import{S as je}from"./Service-a2d19084.js";import{d as se}from"./dayjs.min-ac6c82aa.js";import{r as Pe,u as ie}from"./xlsx-4ad528ac.js";import{e as Me}from"./exceljs.min-3890d7de.js";const Le=me("usePmsHelperStore",()=>{const _=Ee(),B=pe(),I=o(),w=o(),p=o();o(!1);const F=o(),G=async a=>{await c.get(`/api/getKpiFormAsDropdown/${141}`).then(i=>{w.value=i.data})},q=async a=>{await c.get(`/api/getManagersListForEmployees/${141}`).then(i=>{p.value=i.data})},H=(a,i,n)=>{if(a){for(const r of a)if(r.reviewer_user_code===i&&r.is_accepted===n)return!0}return!1},V=a=>{for(const i of a)if(i.is_assignee_accepted==""&&i.is_reviewer_accepted==1)return!0;return!1},L=(a,i)=>a===0?0:i/a*100,z=(a,i,n)=>{a.find(d=>d.id==i);const r=a.findIndex(d=>d.id===i);r!==-1&&a.splice(r,1),a.push(n)},oe=(a,i)=>{if(a)return a.filter(n=>{n.is_assignee_submitted==i})},E=async a=>{const i=new Me.Workbook,n=i.addWorksheet("Sheet1");n.addRow(a).eachCell((v,g)=>{v.fill={type:"pattern",pattern:"solid",fgColor:{argb:"252f70"}},v.font={bold:!0,color:{argb:"ffffff"}},n.getColumn(g).width=20});const d=await i.xlsx.writeBuffer(),f=window.URL.createObjectURL(new Blob([d])),u=document.createElement("a");u.href=f,u.download="pms_kpi_form.xlsx",u.click(),window.URL.revokeObjectURL(f)},K=a=>{if(a){var i=a.target.files[0];F.value=i}else B.add({severity:"error",summary:"file missing!",detail:"selected",life:2e3})},ne=()=>{var a=F.value;if(a){var i=new FileReader;i.onload=function(n){const r=i.result;var d=Pe(r,{type:"binary",cellDates:!0,dateNF:"dd-mm-yyyy"}),f=d.Sheets[d.SheetNames[0]];let u=[];const v={},g=ie.decode_range(f["!ref"]);let b;const R=g.s.r;for(b=g.s.c;b<=g.e.c;++b){const O=f[ie.encode_cell({c:b,r:R})];let x="UNKNOWN "+b;O&&O.t&&(x=ie.format_cell(O)),v[b]=x;let h={title:v[b],value:v[b]};v[b].includes("UNKNOWN")||u.push(h)}const k=d.SheetNames.reduce((O,x)=>{const h=d.Sheets[x];return O[x]=ie.sheet_to_json(h,{raw:!1,dateNF:"dd-mm-yyyy"}),O},{}),$=J(k.Worksheet);_.createKpiForm.form_details=$},i.readAsArrayBuffer(a)}};function J(a){return a.map(n=>{const r={};for(let d in n){let f=d.toLowerCase().replace(/[\s-]+/g,"_"),u=n[d];typeof u=="string"&&(d.toLowerCase().includes("kpi")&&d.toLowerCase().includes("weightage")?f="kpi_weightage":d.toLowerCase()==="objective"&&(f="dimension"),u=u.replace("%","")),r[f]=u}return r})}const U=(a,i)=>{if(a)return a.find(n=>n.header_name===i)};function A(a,i){B.add({severity:a,summary:i,life:3e3})}const re=(a,i,n)=>{if(a)return a.filter(r=>r.is_assignee_accepted==i&&r.is_assignee_submitted==n)},y=(a,i,n)=>{if(a)return a.filter(r=>r.is_assignee_accepted==i&&r.is_reviewer_accepted==n||r.status=="Accept Pending")},W=(a,i,n)=>{if(a)return a.filter(r=>r.is_assignee_accepted==i&&r.is_assignee_submitted==n)},Q=(a,i,n,r,d,f)=>{if(a)return a.filter(u=>{if(f=="pending")return u.is_assignee_accepted==i&&u.is_reviewer_accepted==n||u.is_assignee_accepted==r&&u.is_reviewer_accepted==d;if(f=="current")return u.status==i||u.status==n})},X=(a,i,n)=>{if(a)return a.filter(r=>{if(n=="Completed")return r.is_reviewer_submitted==i})},T=(a,i,n)=>{if(a)return a.filter(d=>{const f=d.is_assignee_submitted==1,v=d.reviewer_details&&d.reviewer_details.length>0&&d.reviewer_details.some(g=>g.reviewer_user_code==n&&g.is_reviewed==i);return f&&v})},Y=(a,i)=>(console.log(i),a&&i?a.filter(r=>i.includes(parseInt(r.department_id))):a),Z=a=>{const i={};return a.forEach(n=>{const{header_name:r}=n;i[r]=null}),i},ee=(a,i)=>{const n=Object.keys(a),r=Object.keys(i),d=r.filter(u=>!n.includes(u)),f=n.filter(u=>!r.includes(u));if(d.length>0||f.length>0)return!0};function le(a){for(const i in a)if(a.hasOwnProperty(i)&&a[i]===null)return!1;return!0}function ae(a){for(const i of a)if(!le(i))return console.log("Object keys must not contain null values."),!1;return!0}return{KpiForms:w,getKpiAsDropdown:G,ManagerList:p,getManagerList:q,calculateKpiWeightage:L,pushToArray:z,pmsReviewIsCompleted:H,pmsKpiFormAcceptance:V,filterDashboardDetails:oe,downloadExcelFile:E,convertExcelIntoArray:K,findSelectedHeaderIsEnabled:U,filterSelfAppraisalStatusWiseSource:re,filterSelfAppraisalPendingStatusSource:y,filterTeamAppraisalPendingSource:W,filterTeamAppraisalCurrentSource:T,filterDepartmentWiseEmployee:Y,convertToNewObject:Z,compareHeaders:ee,doAllObjectsHaveNotNullKeys:ae,toastmessage:A,excelupload:F,uploadconvertExcelIntoArray:ne,filterOrgPendingStatusSource:Q,filterOrgcompletedStatusSource:X,activetab:I,filter_team_current:(a,i,n)=>{if(console.log(a),a)return a.filter(r=>r.is_assignee_submitted==i&&r.is_reviewer_submitted==n)}}}),Ee=me("usePmsMainStore",()=>{const _=je(),B=o(""),I=pe(),w=Le(),p=o(!0),F=o(),G=o(),q=o(),H=o();o();const V=o(),L=o(),z=o(),oe=o(),E=o();o(),o();const K=o();o();const ne=o(!1),J=o(),U=o(),A=o(),re=o(),y=o(),W=o(),Q=o(),X=o(),T=o(),Y=o(!1),Z=o(!1),ee=o(),le=o(),ae=o(!1),C=o(),a=o(),i=o(),n=o();o([]);const r=o(),d=o(),f=o();Ne("$swal");const u=()=>{F.value=[],U.value=[],L.value=[],E.value=[]},v=async(s,t)=>{u(),p.value=!0,await c.post(`${window.location.origin}/api/pms/populateNewGoalsAssignScreenUI`,{flow_type:s,user_code:t}).then(e=>{F.value=e.data.data?e.data.data.pms_config:[],U.value=e.data.data?e.data.data.pms_config.selected_header:[],L.value=e.data.data?e.data.data.department:[],E.value=e.data.data?e.data.data.employee_details:[],console.log(L.value,E.value),X.value=e.data.data.add_btn_status,s==3?(V.value=e.data.data?e.data.data.department_id[0].id:0,h.value.department=e.data.data.department_id[0].id?e.data.data.department_id[0].id:0,K.value=e.data.data?{employee_name:e.data.data.employee_details.name,manager_name:e.data.data.manager_details.name,assignee_id:e.data.data.employee_details.id,reviewer_id:e.data.data.manager_details.id,flow_type:3}:""):s==2?K.value=e.data.data?{manager_name:e.data.data.manager_details.name,reviewer_id:e.data.data.manager_details.id,flow_type:2}:"":s==1&&(K.value=e.data.data?{manager_name:e.data.data.manager_details.name,reviewer_id:e.data.data.manager_details.id,flow_type:2}:"")}).finally(()=>{s==3?h.value={...F.value,...K.value,department_id:V.value}:s==2?D.value={...F.value,...K.value}:s==1&&(D.value={...F.value,...K.value}),p.value=!1})},g=async(s,t)=>{i.value=t,await c.post(`${window.location.origin}/api/pms/getAssignedTimelineDetails`,{user_code:s,assigned_form_id:t||A.value}).then(e=>{r.value=e.data})},b=s=>{let t=_.current_user_code;c.post(`${window.location.origin}/api/pms/withdrawEmployeeAssignedForm`,{record_id:s.id}).then(e=>{v(3,t),k(t),R(t)})},R=async s=>{await c.post(`${window.location.origin}/api/pms/getDashboardCardDetails_SelfAppraisal`,{user_code:s,assignment_setting_id:T.value,assinged_record_id:A.value}).then(t=>{q.value=t.data.data}).finally(()=>{p.value=!1})};async function k(s){p.value=!0,await c.post(`${window.location.origin}/api/pms/getSelfAppraisalFormDetails`,{user_code:s,date:C.value}).then(t=>{G.value=t.data.data,A.value=t.data&&t.data.data.length>0?t.data.data[0].id:"",g(_.current_user_code,A.value)}).finally(()=>{p.value=!1})}const $=async s=>{p.value=!0,await c.post(`${window.location.origin}/api/pms/TeamAppraisalReviewerFlow`,{user_code:s,date:C.value}).then(t=>{H.value=t.data.data}).finally(()=>{p.value=!1})},O=async(s,t,e)=>{await c.post(`${window.location.origin}/api/pms/ApproveOrReject`,{user_code:_.current_user_code,record_id:s,status:t,reviewer_comments:e}).then(l=>{H.value=l.data.data,Swal.fire({title:l.data.status,text:l.data.message,icon:l.data.status=="success"?"success":"warning"}).then(()=>{})}).finally(()=>{$(_.current_user_code)})},x=async s=>{await c.post(`${window.location.origin}/api/pms/getKPIFormsList`,{user_code:s}).then(t=>{z.value=t.data.data}).finally(()=>{})},h=o({}),D=o({}),N=o({user_code:null,form_details:[]}),ce=o({}),fe=s=>{N.value.form_details.push(s),ce.value={}},_e=async s=>{try{const t=await c.post(`${window.location.origin}/api/pms/SampleKpiFormExcellV3`,{user_code:s},{responseType:"arraybuffer"}),e=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=document.createElement("a");l.href=window.URL.createObjectURL(e),l.download=`OKR FORM ${_.current_user_code} ${_.current_user_name} ${se(new Date).format("MMM YYYY")}.xlsx`,document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(t){console.error("Error downloading Excel file:",t)}},we=(s,t)=>{N.value.user_code=s,N.value.form_id=y.value,c.post(`${window.location.origin}/api/pms/saveOrUpdateKpiFormDetails`,N.value).then(e=>{y.value=e.data?e.data.message=="failure"?"":e.data.data:"",e.data.status=="success"?(W.value="success",w.toastmessage("success",e.data.message)):(W.value="failure",w.toastmessage("error",e.data.message))}).finally(()=>{x(N.value.user_code)})},ge=(s,t)=>{let e={record_id:s,json_formrow_details:{...t}};c.post(`${window.location.origin}/api/pms/updateFormRowDetails`,e).catch(l=>{})},ve=s=>{c.post(`${window.location.origin}/api/pms/getSelectedKPIForm`,{form_id:s}).then(t=>{N.value.form_name=t.data.form_name,N.value.form_details=t.data.form_data})},te=o({assignee_user_code:null,record_id:null,assignee_review:[],assignee_is_submitted:0}),he=(s,t,e,l)=>{if(e){te.value.record_id=t,te.value.assignee_user_code=J.value;let j={id:s,target:parseInt(e),kpi_weightage:w.calculateKpiWeightage(l,e),comments:""};w.pushToArray(te.value.assignee_review,s,j)}},ye=async(s,t,e)=>{let l=_.current_user_code;console.log(s);let M=s.map(({assignee_review:m,id:P})=>({form_details_id:P,kpi_review:m.kpi_review,kpi_percentage:m.kpi_percentage,kpi_comments:m.kpi_comments})),S={assignee_user_code:_.current_user_code,assigned_form_id:e,assignee_reviews:M,assignee_is_submitted:t};t==1?w.doAllObjectsHaveNotNullKeys(M)?(p.value=!0,await c.post(`${window.location.origin}/api/pms/saveAssigneeReview`,S).then(P=>{t==null?w.toastmessage(P.data.status,P.data.message):(p.value=!1,Y.value=!1,Swal.fire({title:P.data.status,text:P.data.message,icon:P.data.status=="success"?"success":"warning"}).then(()=>{})),g(l),R(l),k(l)}).catch(P=>{}).finally(()=>{})):I.add({severity:"warn",summary:"Validation",detail:"Fill missing fields",life:3e3}):await c.post(`${window.location.origin}/api/pms/saveAssigneeReview`,S).then(m=>{t==null?w.toastmessage(m.data.status,m.data.message):Swal.fire({title:m.data.status,text:m.data.message,icon:m.data.status=="success"?"success":"warning"}).then(()=>{}),g(l),R(l),k(l)}).catch(m=>{}).finally(()=>{})},be=async s=>{s?await c.post(`${window.location.origin}/api/pms/AcceptOrReject`,s).then(t=>{Swal.fire({title:t.data.status,text:t.data.message,icon:t.data.status=="success"?"success":"warning"}).then(()=>{})}):w.toastmessage("error","data not found")};async function Se(s){let t=s;p.value=!0,h.value.kpi_form_id=y.value?y.value:h.value.kpi_form_id,await c.post(`${window.location.origin}/api/pms/publishKpiform`,h.value).then(e=>{p.value=!1,Swal.fire({title:e.data.status=="success"?"Success":"Failure",text:e.data.status=="success"?`Your team's OKR/KPI form has been successfully published for the period of ${se(new Date).format("MMMM")}. Wishing your team all the best as you take action to achieve this goal!`:e.data.message,icon:e.data.status=="success"?"success":"warning"}).then(()=>{})}).finally(()=>{k(t),R(t),v(3,t)})}async function Fe(s){let t=s;h.value.kpi_form_id=y.value?y.value:h.value.kpi_form_id,await c.post(`${window.location.origin}/api/pms/selfAppraisalEditedFormPublish`,{assigned_record_id:A.value}).then(e=>{Swal.fire({title:e.data.status=="success"?"Success":"Failure",text:e.data.status=="success"?`Your team's OKR/KPI form has been successfully published for the period of ${se(new Date).format("MMMM")}. Wishing your team all the best as you take action to achieve this goal!`:e.data.message,icon:e.data.status=="success"?"success":"warning"}).then(()=>{})}).finally(()=>{k(t),R(t)})}const Ae=async(s,t)=>{D.value.assignee_id=de(D.value.assignee_id),D.value.kpi_form_id=y.value?y.value:D.value.kpi_form_id,D.value.flow_type=t,await c.post(`${window.location.origin}/api/pms/publishKpiform`,D.value).then(e=>{Swal.fire({title:e.data.status=="success"?"Success":"Failure",text:e.data.status=="success"?`Your team's OKR/KPI form has been successfully published for the period of ${se(new Date).format("MMMM")}. Wishing your team all the best as you take action to achieve this goal!`:e.data.message,icon:e.data.status=="success"?"success":"warning"}).then(()=>{})}).finally(()=>{})};function de(s){if(s)return s.filter(t=>t.form_assigned==0)}function Re(s){c.post(`${window.location.origin}/api/pms/deleteFormRowDetails`,{record_id:s}).then(t=>{})}async function ke(s,t){let e=_.current_user_code;await c.post(`${window.location.origin}/api/pms/managerRevokeApprovedOrRejectedAssignedForm`,{assigned_form_id:s,type:t}).then(l=>{Y.value=!1,I.add({severity:`${l.data.status}`,summary:"Revoke",detail:`${l.data.message}`,life:3e3})}).finally(()=>{$(e),R(e),k(e),g(e)})}const De=async(s,t)=>{let l=s.map(({id:S,reviews_review:m})=>({form_details_id:S,kpi_review:m[0].kpi_review,kpi_percentage:m[0].kpi_percentage,kpi_comments:m[0].kpi_comments}));const j=_.current_user_code;let M={reviewer_user_code:j,assigned_form_id:A.value,reviewer_review:l,reviewer_is_submitted:t};t==1?w.doAllObjectsHaveNotNullKeys(l)?(p.value=!0,await c.post(`${window.location.origin}/api/pms/saveReviewsReview`,M).then(m=>{t==0?w.toastmessage(m.data.status,m.data.message):(p.value=!1,Z.value=!1,Swal.fire({title:m.data.status,text:m.data.message,icon:m.data.status=="success"?"success":"warning"}).then(()=>{}))}).finally(()=>{$(j)})):I.add({severity:"warn",summary:"Validation",detail:"Fill missing fields",life:3e3}):await c.post(`${window.location.origin}/api/pms/saveReviewsReview`,M).then(S=>{t==0?w.toastmessage(S.data.status,S.data.message):Swal.fire({title:S.data.status,text:S.data.message,icon:S.data.status=="success"?"success":"warning"})}).finally(()=>{$(j)})},Ke=async(s,t)=>{await c.post(`${window.location.origin}/api/pms/getDashboardCardDetails_TeamAppraisal`,{user_code:s,type:t}).then(e=>{Q.value=e.data})},$e=async s=>{let t="";await c.get(` ${window.location.origin}/session-sessionselectedclient`).then(e=>{t=e.data.id}),await c.post(`${window.location.origin}/api/pms/getAssignmentPeriodDropdown`,{user_code:s,client_id:t}).then(e=>{ee.value=e.data,e.data.map(({current_period:l,assignment_id:j,assignment_period:M})=>{l==1&&(T.value=j,C.value=M)})})},Oe=s=>{T.value=s,s&&(k(_.current_user_code),R(_.current_user_code),$(_.current_user_code),ue())},xe=s=>{console.log(s)},ue=async()=>{await c.post(`${window.location.origin}/api/pms/orgAppraisalFlow`,{date:C.value}).then(s=>{a.value=s.data})};return{canShowLoading:p,client_id:B,assignment_setting_id:T,selectedrowdata:xe,User_code:d,record_id:A,form_id:re,currentlySavedFormId:y,selectedyear:ee,addGoalStatus:X,currentlyselectedform:n,pmsConfiguration:F,getPmsConfiguration:v,departmentOptions:L,EmployeeOptions:E,existingKpiFormOptions:z,getKPIFormAsDropdown:x,selfDashboardPublishedFormList:G,createSelfKpiSidebar:Y,getSelfAppraisalDashboardDetails:k,assigneeReviewForm:te,acceptRejectReviewForm:be,selfReviewDashboardSource:q,getSelfReviewDashboardDetails:R,getSelfTimeLine:g,SelfTimeLine:r,updateFormRowDetails:ge,deleteFormRowDetails:Re,createKpiForm:N,addKra:ce,addFormDetails:fe,saveKpiForm:we,getKPIFormDetails:ve,fillAssigneeReviewForm:he,canShowAssigneeReviewForm:ne,saveAssigneeReviewForm:ye,selectedAssigneeFormUsercode:J,kpiFormHeaders:oe,selected_header:U,downloadSampleForm:_e,createNewGoals:h,publishForm:Se,createTeamKpiForm:Z,createNewTeamGoals:D,publishTeamForm:Ae,EditedpublishForm:Fe,saveTeamAppraisalReview:De,getTeamAppraisalDashboardDetails:$,teamDashboardPublishedFormList:H,teamKpiFormApproval:O,withdrawEmployeeAssignedForm:b,TeamAppraisalRevoke:ke,errormessage:W,getDashboardCardDetails_TeamAppraisal:Ke,DashboardCardDetails_TeamAppraisal:Q,getAssignmentPeriodDropdown:$e,selecteddropdownyear:Oe,employeefilter:de,orgAppraisalFlow:ue,orgAppraisalDatatableDetails:a,activetab:f,form_header:le,downloadFormPMSReport:()=>{let s={assinged_formid:i.value?i.value:A.value};p.value=!0;let t=`${window.location.origin}/api/pms/pmsFormExcellExport`;c.post(t,s,{responseType:"blob"}).then(e=>{var l=document.createElement("a");l.href=window.URL.createObjectURL(e.data),l.download="PMS Form Report_.xlsx",l.click()}).finally(()=>{ae.value=!1,p.value=!1})},btn_download:ae,assignment_setting_date:C,reset:u}});export{Le as a,Ee as u};
