import{q as ne,u as re,r as a,y as ce,p as ie,b as N,d as i,e as d,f as n,g as m,m as F,k as R,F as B,l as de,j as ue,t as g,n as w,h as pe,C as me,_ as _e,a as ye,i as fe}from"./app-e1ab7da0.js";import{r as ve,u as D}from"./xlsx-4ad528ac.js";import"./dayjs.min-ac6c82aa.js";import{S as Q}from"./Service-a2d19084.js";const X=ne("useImportSalaryAdvance",()=>{re();const O=a(!1),r=ce(),u=a(),E=a(),S=a(),_=a([]),f=a([]);a(!1),a(!1);const h=a(),L=a(),v=e=>{S.value=e.target.files[0]},o=(e,t)=>{if(e){var l=e.target.files[0];if(!l)return;var b=new FileReader;b.onload=function(T){const x=b.result;var I=ve(x,{type:"binary",cellDates:!0,dateNF:"dd-mm-yyyy"}),J=I.Sheets[I.SheetNames[0]];let U=[];const k={},$=D.decode_range(J["!ref"]);let y;const ae=$.s.r;for(y=$.s.c;y<=$.e.c;++y){const p=J[D.encode_cell({c:y,r:ae})];let A="UNKNOWN "+y;p&&p.t&&(A=D.format_cell(p)),k[y]=A;let j={title:k[y],value:k[y]};k[y].includes("UNKNOWN")||U.push(j)}E.value=U,console.log(U);const C=I.SheetNames.reduce((p,A)=>{const j=I.Sheets[A];return p[A]=D.sheet_to_json(j,{raw:!1,dateNF:"dd-mm-yyyy"}),p},{}),V=Object.keys(C)[0];C[V]?u.value=C[V]:u.value=[],u.value&&Y(u.value),_.value.push(u.value);for(let p=0;p<C[V].length;p++)console.log("jsonData['Sheet1'].length :",C[V].length),G(u.value[p])},b.readAsArrayBuffer(l)}else r.add({severity:"error",summary:"file missing!",detail:"selected",life:2e3})},s=e=>{let t="/saveComponentsUploadPage";f.value==0?ie.post(t,e).then(l=>{l.data.status=="failure"?r.add({severity:"error",summary:"failure",detail:`${l.data.message}`,life:3e3}):l.data.status=="success"&&l.data.data.forEach(b=>{r.add({severity:"success",summary:`${b.Employee_Name}`,detail:`${b.message}`,life:3e3})})}).finally(()=>{}):r.add({severity:"error",summary:"Failure!",detail:"Clear error fields",life:3e3})};function M(e){return e.filter((t,l)=>e.indexOf(t)!==l)}let P=a([]),H=a([]),K=a([]),q=a([]),z=a([]),W=a([]);const Y=e=>{e.forEach(t=>{P.value.push(t["Employee Code"]),H.value.push(t.Email),K.value.push(t["Mobile Number"]),q.value.push(t["Pan No"]),z.value.push(t.Aadhar),W.value.push(t["Account No"])})},Z=(e,t)=>!!M(e).includes(t),ee=(e,t)=>(console.log(t),!!e.includes(t)),se=e=>c(e)<=0,oe=a([{id:"1",name:"Salary advance"},{id:"2",name:"Interest free loan"},{id:"3",name:"Travel advance"},{id:"4",name:"Interest with loan"}]),te=(e,t,l)=>{if(console.log({balance:e,loanAmt:t,Repayment:l}),console.log(`loanAmount${c(t)}`),console.log(`repaymentAmount${c(l)}`),e){let x;var T=/\d/.test(l);return T?(x=c(t)-c(l),c(e)!=x):(x=c(t),console.log("======Balance====="+x),c(e)!=x)}console.log(c(e)==balance)},le=(e,t,l)=>{if(console.log({emi:e,balance:t,tenure:l}),e){let T=c(t)/c(l);return console.log("Actual emi:"+c(e)),console.log("subbed emi:"+T),c(e)!=T}},c=e=>{if(e){console.log(e.split(".")[0]);var t=e.split(".")[0],l=t.match(/\d/g);if(l)return l=l.join(""),console.log(`convertRupeeIntoNumber${l}`),parseInt(l)}},G=e=>(console.log(h.value),[]);return{getCurrentlyImportedTableDuplicateEntries:Y,currentlyImportedTableEmployeeCodeValues:P,findCurrentTableDups:Z,uploadOnboardingFile:s,type:L,currentlyImportedTableAadharValues:z,currentlyImportedTablePanValues:q,currentlyImportedTableAccNoValues:W,currentlyImportedTableEmailValues:H,currentlyImportedTableMobileNumberValues:K,loanAmount:se,loanTypes:oe,findBalanceAmount:te,findEmiCalculation:le,isExistsOrNot:ee,convertExcelIntoArray:o,EmployeeSalaryAdvanceDynamicHeader:E,EmployeeSalaryAdvanceSource:u,getValidationMessages:G,getExcelForUpload:v,canShowloading:O}}),be={class:"grid w-10/12 grid-cols-3 mx-auto my-2 place-content-center"},ge={class:"flex"},he=n("label",{class:"p-2 font-semibold border-gray-500 rounded-lg cursor-pointer border-1 fs-6",for:"file"},[n("i",{class:"px-2 pi pi-folder",style:{"font-size":"1rem"}}),pe("Browse")],-1),xe=me('<div class="p-2 mx-6 font-semibold text-black bg-white rounded-lg fs-6">Total Records : <span class="font-bold"> 2324 </span></div><div class="p-2 mx-6 font-semibold text-black bg-green-100 rounded-lg fs-6">Processed Records : <span class="font-bold"> 2342 </span></div><div class="p-2 mx-6 font-semibold text-black bg-red-100 rounded-lg fs-6">Error Records : <span class="font-bold"> 12313 </span></div>',3),Ee=n("div",{class:"py-5"},[n("p",{class:"font-semibold fs-6"},"Sample format:"),n("div",{class:"table-responsive"})],-1),Se={class:"table-responsive"},Ne=n("p",{class:"font-semibold fs-6"},"Original data:",-1),Te={key:0},Ce={class:"font-semibold fs-6"},Ae={key:1},Ie={class:"font-semibold fs-6"},ke={class:"font-semibold fs-6"},Ve={key:3},Re={class:"font-semibold fs-6"},we={class:"font-semibold fs-6"},De={class:"font-semibold fs-6"},Fe={class:"font-semibold fs-6"},Oe={key:7,class:"font-semibold fs-6"},Le={__name:"import_salary_advance",setup(O){Q();const r=X(),u=S=>{let{data:_,newValue:f,field:h}=S;switch(h){case"quantity":case"price":isPositiveInteger(f)?_[h]=f:S.preventDefault();break;default:f.trim().length>0?_[h]=f:S.preventDefault();break}},E=["SALARY ADVANCE","INTEREST FREE LOAN","TRAVEL ADVANCE","INTEREST wITH LOAN"];return(S,_)=>{const f=N("InputText"),h=N("Column"),L=N("DataTable");return i(),d(B,null,[n("div",be,[n("div",ge,[he,n("input",{type:"file",name:"",id:"file",hidden:"",onChange:_[0]||(_[0]=v=>m(r).convertExcelIntoArray(v)),accept:".xls, .xlsx"},null,32)]),xe]),Ee,n("div",Se,[Ne,F(L,{class:"py-4",value:m(r).EmployeeSalaryAdvanceSource,tableStyle:" min-width: 50rem",responsiveLayout:"scroll",stateStorage:"session",stateKey:"dt-state-demo-session",editMode:"cell",onCellEditComplete:u,rows:m(r).EmployeeSalaryAdvanceSource},{footer:R(()=>[n("button",{class:"flex justify-center mx-auto btn btn-orange",onClick:_[1]||(_[1]=v=>m(r).uploadOnboardingFile(m(r).EmployeeSalaryAdvanceSource))},"Upload")]),default:R(()=>[(i(!0),d(B,null,de(m(r).EmployeeSalaryAdvanceDynamicHeader,v=>(i(),ue(h,{key:v.title,field:v.title,style:{"min-width":"12rem"},header:v.title},{body:R(({data:o,field:s})=>[s.includes("Employee Code")?(i(),d("div",Te,[n("p",Ce,g(o[s]?o[s]:"-"),1)])):s.includes("Legal Entity")?(i(),d("div",Ae,[n("p",Ie,g(o[s]?o[s]:"-"),1)])):s.includes("Loan Type")?(i(),d("div",{key:2,class:w([m(r).isExistsOrNot(E,o[s].toUpperCase())?"bg-red-100 p-2 rounded-lg":""])},[n("p",ke,g(o[s]?o[s]:"-"),1)],2)):s.includes("Category")?(i(),d("div",Ve,[n("p",Re,g(o[s]?o[s]:"-"),1)])):s.includes("Loan Amount")?(i(),d("div",{key:4,class:w([m(r).loanAmount(o[s])?"bg-red-100 p-2 rounded-lg":""])},[n("p",we,g(o[s]?o[s]:"-"),1)],2)):s.includes("Balance")?(i(),d("div",{key:5,class:w([m(r).findBalanceAmount(o[s],o["Loan Amount"],o["Repayment Made"])?"bg-red-100 p-2 rounded-lg":""])},[n("p",De,g(o[s]?o[s]:"-"),1)],2)):s.includes("EMI")?(i(),d("div",{key:6,class:w([m(r).findEmiCalculation(o[s],o.Balance,o.Tenure)?"bg-red-100 p-2 rounded-lg":""])},[n("p",Fe,g(o[s]?o[s]:"-"),1)],2)):(i(),d("p",Oe,g(o[s]?o[s]:"-"),1))]),editor:R(({data:o,field:s})=>[F(f,{modelValue:o[s],"onUpdate:modelValue":M=>o[s]=M},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","header"]))),128))]),_:1},8,["value","rows"])])],64)}}};const Me={__name:"salary_advance_excel_import",setup(O){return X(),Q(),a(null),ye(),(r,u)=>{const E=N("Toast");return N("Column"),N("DataTable"),i(),d(B,null,[F(E),fe("",!0),F(Le)],64)}}},Pe=_e(Me,[["__scopeId","data-v-359b1d32"]]);export{Pe as default};
